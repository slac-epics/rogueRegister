#
# PgpChCannedSequences.db
#
# Contains various sequence record's to aid in configuring timing channels
#	
# Required macros:
#	PGP				- Prefix for pgpRogue IOC
#	CH				- Camera channel number 0..3 (lane number)

# Select LCLS-I Timing
record( seq, "$(PGP):Ch$(CH):EvrV2Config" )
{
	field( DESC, "Configure Ch$(CH):EvrV2 Timing" )

	# Configure EvrV2 registers
	field( DLY9, "1.0" ) field( DOL9, "1" ) field( LNK9, "$(PGP):Ch$(CH):EvrV2:FebTrigWidth   PP NMS" )
	field( DLYA, "0.0" ) field( DOLA, "2" ) field( LNKA, "$(PGP):Ch$(CH):EvrV2:RateType       PP NMS" )
	field( DLYB, "0.0" ) field( DOLB, "2" ) field( LNKB, "$(PGP):Ch$(CH):EvrV2:DestType       PP NMS" )
	field( DLYC, "0.1" ) field( DOLC, "1" ) field( LNKC, "$(PGP):Ch$(CH):EvrV2:EnableReg      PP NMS" )
	field( DLYD, "0.1" ) field( DOLD, "1" ) field( LNKD, "$(PGP):Ch$(CH):EvrV2:FebTrigWidth   PP NMS" )
	field( DLYE, "0.1" ) field( DOLE, "1" ) field( LNKE, "$(PGP):Ch$(CH):EvrV2:EnableFebTrig  PP NMS" )
	field( DLYF, "0.1" ) field( DOLF, "1" ) field( LNKF, "$(PGP):Ch$(CH):EvrV2:EnableTrig     PP NMS" )

	info( autosaveFields, "DESC" )
}

# StartRun
record( seq, "$(PGP):Ch$(CH):SeqStartRun" )
{
	field( DESC, "Arm EventBuilder and enable triggers" )
	# Arm EventBuilder for data stream
	field( DLY1, "0" ) field( DOL1, "0" ) field( LNK1, "$(PGP):Ch$(CH):EventBuilder:Blowoff PP NMS" )
	# Reset EventBuilder Pipeline
	field( DLY2, "0" ) field( DOL2, "1" ) field( LNK2, "$(PGP):Ch$(CH):EventBuilder:SoftRst PP NMS" )
	field( DLY3, "0" ) field( DOL3, "0" ) field( LNK3, "$(PGP):Ch$(CH):EventBuilder:SoftRst PP NMS" )
	# Enable triggering
	field( DLY4, "0" ) field( DOL4, "1" ) field( LNK4, "$(PGP):Ch$(CH):Trigger:MasterEnable PP NMS" )

	info( autosaveFields, "DESC" )
}

# StopRun
record( seq, "$(PGP):Ch$(CH):SeqStopRun" )
{
	field( DESC, "Stop triggers & blow off pipeline data" )
	# Disable triggering
	field( DLY1, "0" ) field( DOL1, "0" ) field( LNK1, "$(PGP):Ch$(CH):Trigger:MasterEnable PP NMS" )
	# Blow off data in EventBuilder pipeline
	field( DLY2, "0" ) field( DOL2, "1" ) field( LNK2, "$(PGP):Ch$(CH):EventBuilder:Blowoff PP NMS" )

	info( autosaveFields, "DESC" )
}
